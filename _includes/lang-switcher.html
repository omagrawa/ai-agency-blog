{% assign langs = site.languages | default: 'en' %}
{% if langs and langs.size > 1 %}
<form class="lang-switcher" action="#" onsubmit="return false" aria-label="Language selector">
  <label for="site-lang" class="visually-hidden">Language</label>
  <select id="site-lang" name="lang">
    {% for l in langs %}
      {% assign sel = l == page.lang | default: site.default_lang %}
      <option value="{{ l }}" {% if sel %}selected{% endif %}>{{ l | upcase }}</option>
    {% endfor %}
  </select>
</form>
<script>
(function(){
  function setLang(l){
    try{localStorage.setItem('site_lang', l);}catch(e){}
    document.documentElement.setAttribute('lang', l);
    // If Google Translate widget exists, switch language
    if(window.google && window.google.translate && window.google.translate.TranslateElement){
      var sel=document.querySelector('.goog-te-combo'); if(sel){sel.value=l; sel.dispatchEvent(new Event('change'));}
    }
  }
  function init(){
    var sel=document.getElementById('site-lang'); if(!sel) return;
    var saved=null; try{saved=localStorage.getItem('site_lang');}catch(e){}
    if(saved && sel.value!==saved){ sel.value=saved; setLang(saved); }
    sel.addEventListener('change', function(){ setLang(this.value); });
  }
  if(document.readyState!=='loading') init(); else document.addEventListener('DOMContentLoaded', init);
})();
</script>
<style>.visually-hidden{position:absolute;left:-9999px}.lang-switcher{margin-left:auto}</style>
{% endif %}
